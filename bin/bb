#!/usr/bin/env ruby
require 'rubygems'
require 'bundler/setup'

require 'fileutils'
require 'pathname'

VISIBLE_BUILDER_DIR = 'book-builder'
HIDDEN_BUILDER_DIR = ".#{VISIBLE_BUILDER_DIR}"

books_bin_dir = Pathname(__FILE__).dirname
books_dir = books_bin_dir.dirname
default_builder_dir = books_dir / HIDDEN_BUILDER_DIR
book_dir = Pathname.pwd
builder_dirs = [ book_dir / VISIBLE_BUILDER_DIR, book_dir / HIDDEN_BUILDER_DIR, default_builder_dir ].uniq

rakefile = builder_dirs.map { |d| d / 'Rakefile' }.find { |r| r.file? }
abort "Could not find builder in #{builder_dirs.join(' ')}" unless rakefile

rake_args = ARGV.unshift

system 'rake', '-f', rakefile.to_s, *rake_args
